<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../../commonWeb/css/common.css">
    <link rel="stylesheet" href="css/style.css">
    <title>Connect with Steam</title>
</head>


<body>
    <div class="container">
        <div class="content">
            <header class="main-header">
                <div class="main-header__container">
                    <img class="steam-logo-icon" src="../../commonWeb/img/icon-steam-logo.svg" alt="Steam logo">
                    <div class="main-header__title">
                        <h1 class="title">Connect with Steam</h1>
                        <p class="subtitle">To an existing Steam account</p>
                    </div>
                </div>
            </header>
            <section class="main-content">
                <form id="main-form" class="main-form" action="/" method="GET">
                    <fieldset id="loginFieldset" style="display: none;">
                        <legend>Enter your Steam64 ID and Steam Web API key below to access your Steam games and friends from GOG Galaxy.</legend>
                        <div class="field-group">
                            <label for="steam-id-login">Steam64 ID</label>
                            <input class="basic-input login-input" type="text" id="steam-id-login" name="steam_id" disabled="disabled">
                        </div>
                        <div class="field-group">
                            <label for="steam-id-login">Steam API key</label>
                            <input class="basic-input login-input" type="text" id="steam-api-key" name="api_key" disabled="disabled">
                        </div>
                    </fieldset>
                    <fieldset id="loginErrorFieldset" style="display: none;">
                        <legend>Enter your Steam64 ID below to access your Steam games and friends from GOG Galaxy.</legend>
                        <div class="field-group">
                            <label for="steam-id-error">Steam64 ID</label>
                            <input class="basic-input login-input errored" type="text" id="steam-id-error" name="steam_id" disabled="disabled">
                        </div>
                        <p class="error-message error-message--centered">
                            <img src="../../commonWeb/img/icon-error.svg" alt="" class="error-icon"> Provided Steam64 ID is incorrect.
                        </p>
                    </fieldset>
                    <fieldset id="loginProfileDoesNotExistFieldset" style="display: none;">
                        <legend>Enter your Steam64 ID below to access your Steam games and friends from GOG Galaxy.</legend>
                        <div class="field-group">
                            <label for="steam-id-profile-does-not-exist">Steam64 ID</label>
                            <input class="basic-input login-input errored" type="text" id="steam-id-profile-does-not-exist" name="steam_id" disabled="disabled">
                        </div>
                        <p class="error-message error-message--start">
                            <img src="../../commonWeb/img/icon-error.svg" alt="" class="error-icon error-icon--aligned-top"> Profile with provided Steam64 ID does not exist. Make sure that your provided ID is correct.
                        </p>
                    </fieldset>
                    <fieldset id="loginProfileIsNotPublicFieldset" style="display: none;">
                        <legend>Enter your Steam64 ID below to access your Steam games and friends from GOG Galaxy.</legend>
                        <div class="field-group">
                            <label for="steam-id-profile-is-not-public">Steam64 ID</label>
                            <input class="basic-input login-input errored" type="text" id="steam-id-profile-is-not-public" name="steam_id" disabled="disabled">
                        </div>
                        <p class="error-message error-message--start" ">
                            <img src="../../commonWeb/img/icon-error.svg" alt="" class="error-icon error-icon--aligned-top"> Your Steam profile is not public.
                        </p>
                        <br>
                        <p>
                            <a class="steam-help" href="https://support.steampowered.com/kb_article.php?ref=4113-YUDH-6401&l=" target="_blank">How to change Steam profile privacy?</a>
                        </p>
                    </fieldset>
                </form>
            </section>
            <footer class="main-footer">
                <div class="main-footer__container">
                    <a class="steam-help" href="https://steamid.xyz/" target="_blank">Help me find my Steam ID</a>
                </div>
                <div class="main-footer__container main-footer__container--left">
                    <a class="steam-help" href="/open_in_default_browser?link=https://steamcommunity.com/login/home/?goto=%2Fmy%2Fprofile">Open my profile</a>
                </div>
                <div class="main-footer__container">
                    <button class="basic-button main-footer__button main-footer__button--primary" type="submit" form="main-form">Continue</button>
                </div>
            </footer>
        </div>
    </div>

    <script>
        const urlParamsObj = {
            login: "?view=login",
            loginErrored: "?view=login&errored=true",
            loginProfileDoesNotExist: "?view=login&profile_does_not_exist=true",
            loginProfileIsNotPublic: "?view=login&profile_is_not_public=true",
        };

        const fieldSetsObj = {

            loginFieldSet: document.querySelector("#loginFieldset"),
            loginInputs: document.querySelectorAll("#loginFieldset input"),

            loginErrorFieldset: document.querySelector("#loginErrorFieldset"),
            loginErroredInputs: document.querySelectorAll("#loginErrorFieldset input"),

            loginProfileDoesNotExistFieldset: document.querySelector("#loginProfileDoesNotExistFieldset"),
            loginProfileDoesNotExistInputs: document.querySelectorAll("#loginProfileDoesNotExistFieldset input"),

            loginProfileIsNotPublicFieldset: document.querySelector("#loginProfileIsNotPublicFieldset"),
            loginProfileIsNotPublicInputs: document.querySelectorAll("#loginProfileIsNotPublicFieldset input"),

        }

        function handleEnablingInputs(inputs) {
            for (let i = 0; i < inputs.length; i++) {
                inputs[i].disabled = false;
            }
        }

        function handleParamsAndFormAction() {
            const url = window.location.search;
            const formElement = document.querySelector("#main-form");

            switch (url) {
                case urlParamsObj.login:
                    fieldSetsObj.loginFieldSet.style.display = "block";
                    handleEnablingInputs(fieldSetsObj.loginInputs);
                    formElement.action = "/login_finished";
                    break;
                case urlParamsObj.loginErrored:
                    fieldSetsObj.loginErrorFieldset.style.display = "block";
                    handleEnablingInputs(fieldSetsObj.loginErroredInputs);
                    formElement.action = "/login_finished";
                    break;
                case urlParamsObj.loginProfileDoesNotExist:
                    fieldSetsObj.loginProfileDoesNotExistFieldset.style.display = "block";
                    handleEnablingInputs(fieldSetsObj.loginProfileDoesNotExistInputs);
                    formElement.action = "/login_finished";
                    break;
                case urlParamsObj.loginProfileIsNotPublic:
                    fieldSetsObj.loginProfileIsNotPublicFieldset.style.display = "block";
                    handleEnablingInputs(fieldSetsObj.loginProfileIsNotPublicInputs);
                    formElement.action = "/login_finished";
                    break;
                default:
                    fieldSetsObj.loginFieldSet.style.display = "block";
                    handleEnablingInputs(fieldSetsObj.loginInputs);
                    formElement.action = "/login_finished";
            }
        }
        window.addEventListener("load", handleParamsAndFormAction);
    </script>

</body>

</html>
